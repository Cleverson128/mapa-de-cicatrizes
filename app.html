<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workbook - O Mapa das Cicatrizes</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --primary: #1a472a; /* Verde Profundo */
            --secondary: #2d5a3f; 
            --accent: #c5a059; /* Dourado */
            --bg: #f4f4f0; 
            --text: #333;
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HEADER & CONTROLES */
        .top-controls {
            display: flex;
            justify-content: flex-end;
            padding: 10px 20px;
            background: rgba(26, 71, 42, 0.05);
            gap: 15px;
            font-size: 0.85rem;
        }

        .btn-link {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .btn-link:hover { color: var(--accent); }

        /* BARRA DE PROGRESSO */
        .progress-wrapper {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: var(--bg);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .progress-bar-bg { width: 100%; height: 6px; background: #e0e0e0; }
        .progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s ease; }
        .progress-text {
            text-align: center; font-size: 0.85rem; color: var(--primary);
            padding: 5px 0; font-weight: bold; text-transform: uppercase;
            letter-spacing: 1px; background: #fff; border-bottom: 1px solid #eee;
        }

        /* CONTAINER */
        .app-container {
            max-width: 900px; width: 95%; margin: 20px auto;
            background: var(--white); box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 8px; overflow: hidden; min-height: 70vh;
            padding-bottom: 80px; position: relative;
        }

        /* STEPS */
        .step { display: none; padding: 30px 40px; animation: fadeIn 0.6s ease-out; }
        .step.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* TIPOGRAFIA */
        h1 { font-family: 'Cinzel', serif; font-size: 2.8em; line-height: 1.1; color: var(--white); margin-bottom: 15px; }
        h2 { color: var(--primary); font-family: 'Cinzel', serif; border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 25px; margin-top: 20px; font-size: 1.8em; }
        h3 { color: var(--secondary); font-family: 'Cinzel', serif; font-size: 1.3em; margin-top: 35px; margin-bottom: 15px; font-weight: bold; border-left: 4px solid var(--accent); padding-left: 10px; }

        /* CAPA */
        .cover-section {
            background: linear-gradient(135deg, var(--primary) 0%, #0d2b18 100%);
            color: var(--white); text-align: center; padding: 60px 20px;
            border: 4px double var(--accent); margin: 15px; border-radius: 4px;
        }

        /* ELEMENTOS DE TEXTO */
        .quote-box { background: #fdfbf7; border-left: 4px solid var(--accent); padding: 20px; font-style: italic; color: #555; margin: 25px 0; font-family: 'Georgia', serif; font-size: 1.1em; }
        .alert-box { background: rgba(197, 160, 89, 0.1); border: 1px solid var(--accent); padding: 20px; border-radius: 4px; margin: 25px 0; color: #4a4a4a; }
        .info-box { background: #e3f2fd; border-left: 4px solid #1976d2; padding: 20px; margin: 25px 0; color: #0d47a1; }

        /* LISTAS */
        .instruction-list { list-style: none; counter-reset: item; margin-top: 20px; }
        .instruction-list li { counter-increment: item; margin: 20px 0; padding-left: 45px; position: relative; }
        .instruction-list li:before {
            content: counter(item); position: absolute; left: 0; top: 0;
            background: var(--primary); color: var(--accent); width: 30px; height: 30px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-family: 'Cinzel', serif;
        }
        
        .checklist { list-style: none; padding-left: 10px; margin: 15px 0; }
        .checklist li { margin-bottom: 12px; display: flex; align-items: flex-start; gap: 10px; }
        .checklist li::before { content: "‚úì"; color: var(--accent); font-weight: bold; font-size: 1.2em; line-height: 1.4; }

        /* INPUTS */
        label { display: block; font-weight: bold; color: var(--primary); margin-top: 15px; font-size: 0.95em; margin-bottom: 5px; }
        textarea, input[type="text"], input[type="number"], input[type="date"] {
            width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px;
            font-family: 'Lato', sans-serif; background: #fafafa; transition: 0.3s;
        }
        textarea:focus, input:focus { outline: none; border-color: var(--accent); background: #fff; box-shadow: 0 0 5px rgba(197, 160, 89, 0.3); }
        textarea { min-height: 80px; resize: vertical; }
        .checkbox-item { margin: 10px 0; display: flex; align-items: center; gap: 10px; }
        input[type="checkbox"], input[type="radio"] { width: 18px; height: 18px; margin: 0; accent-color: var(--primary); }
        .checkbox-item label { margin: 0; font-weight: normal; color: #444; }

        /* CARD STYLE */
        .card-repeat { background: #fff; border: 1px solid #eee; border-left: 4px solid var(--secondary); border-radius: 4px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .cicatriz-header { color: var(--accent); font-size: 1.1em; border-bottom: 1px solid #eee; display: block; margin-bottom: 15px; padding-bottom: 5px; font-weight: bold; }

        /* NAVEGA√á√ÉO */
        .nav-controls {
            position: absolute; bottom: 0; left: 0; width: 100%; background: var(--white);
            padding: 20px 40px; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }
        .btn { padding: 12px 25px; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-prev { background: #f0f0f0; color: #555; }
        .btn-next { background: var(--primary); color: white; }
        .btn-pdf { background: var(--accent); color: var(--primary); font-weight: 800; box-shadow: 0 4px 10px rgba(197, 160, 89, 0.4); }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }

        /* AREA PDF (Melhorada para Impress√£o) */
        #print-area { 
            display: none; 
            font-family: 'Georgia', serif; 
            color: #111; 
            background: #fff; 
            padding: 20px 40px; 
            width: 100%;
            max-width: 800px;
        }
        
        .pdf-header { 
            text-align: center; 
            margin-bottom: 20px; 
            border-bottom: 2px solid var(--accent); 
            padding-bottom: 10px; 
        }

        .pdf-section { 
            page-break-inside: avoid; /* Impede quebra no meio do bloco */
            break-inside: avoid;      
            margin-bottom: 15px; 
            border: 1px solid #eee;   
            border-radius: 4px;
            padding: 15px;
            background-color: #fff;
        }

        .pdf-section-title { 
            color: var(--primary); 
            font-size: 1.2em; 
            font-family: 'Cinzel', serif; 
            margin-bottom: 10px; 
            border-bottom: 1px solid #ddd; 
            padding-bottom: 5px; 
            font-weight: bold;
        }

        .pdf-q { 
            font-weight: bold; 
            color: #000; 
            font-size: 0.95em; 
            margin-top: 8px; 
            margin-bottom: 3px; 
        }

        .pdf-a { 
            background: #f9f9f9; 
            padding: 8px 10px; 
            border-left: 3px solid var(--secondary); 
            font-style: italic; 
            margin-bottom: 8px; 
            font-size: 0.9em; 
            color: #333; 
            line-height: 1.4;
            text-align: justify;
        }
        
        .pdf-check-item { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; font-size: 0.9em; }
        .pdf-check-icon { font-size: 1.1em; color: var(--primary); }

        @media(max-width: 600px) {
            .app-container { margin: 0; border-radius: 0; width: 100%; min-height: 100vh; }
            .step { padding: 20px; padding-bottom: 100px; }
            h1 { font-size: 2em; }
            .nav-controls { padding: 15px; }
            .cover-section { margin: 0; border: none; padding: 40px 20px; }
        }
    </style>
</head>
<body>

    <div class="top-controls">
        <input type="file" id="importFile" style="display: none;" onchange="importData(this)">
        <button class="btn-link" onclick="document.getElementById('importFile').click()"><i class="fas fa-upload"></i> Restaurar Backup</button>
        <button class="btn-link" onclick="exportData()"><i class="fas fa-download"></i> Salvar Rascunho</button>
    </div>

    <div class="progress-wrapper">
        <div class="progress-bar-bg">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="progress-text" id="progressText">Iniciando...</div>
    </div>

    <div class="app-container">
        
        <div class="step active" id="step0">
            <div class="cover-section">
                <h1>MAPEIE<br>SUAS<br>CICATRIZES</h1>
                <div style="font-size: 1.2em; font-style: italic; margin-bottom: 40px; opacity: 0.9;">Guia Pr√°tico de Autoconhecimento e Reconstru√ß√£o</div>
                
                <div style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 30px; margin-top: 30px;">
                    <div>Por</div>
                    <div style="font-weight: bold; font-size: 1.4em; margin: 10px 0;">Cl√©verson E. Costa</div>
                    <div>Autor de "O Mapa das Cicatrizes"</div>
                </div>

                <button class="btn btn-pdf" style="margin-top: 40px; font-size: 1.1em; padding: 15px 40px;" onclick="nextStep()">
                    INICIAR JORNADA <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <div class="step" id="step1">
            <h2>BEM-VINDO √Ä SUA JORNADA</h2>
            
            <p>Este workbook n√£o √© sobre apagar suas cicatrizes.<br>√â sobre aprender a <strong>l√™-las</strong>.</p>
            <p>Cada ferida que voc√™ carrega conta uma hist√≥ria.<br>N√£o de derrota, mas de sobreviv√™ncia.</p>
            
            <div class="card-repeat" style="border-left-color: var(--accent);">
                <p><strong>Para garantir um resultado real, vamos focar no essencial:</strong></p>
                <ul class="checklist">
                    <li>Vamos mapear as <strong>3 principais cicatrizes</strong> que te definem hoje.</li>
                    <li>Vamos identificar os "Padr√µes de Pensamento" (suas Autoestradas Mentais).</li>
                    <li>Vamos construir seus "Pilares de Vida" (Seu Novo P√≥dio).</li>
                </ul>
            </div>
            
            <div class="alert-box">
                <strong>IMPORTANTE:</strong><br>
                Este √© um trabalho profundo. Reserve tempo. Seja honesto.<br>
                Suas respostas s√£o s√≥ suas.<br><br>
                Ningu√©m precisa ver. Mas <strong>VOC√ä</strong> precisa enxergar.
            </div>
            
            <div class="quote-box">
                "Vamos come√ßar?"<br>- Cl√©verson E. Costa
            </div>

            <hr style="border:0; border-top:1px solid #ccc; margin:30px 0;">

            <h3>COMO USAR ESTE WORKBOOK</h3>
            <ol class="instruction-list">
                <li><strong>ENCONTRE UM LUGAR TRANQUILO</strong><br>15 a 20 minutos sem interrup√ß√µes.</li>
                <li><strong>SEJA BRUTALMENTE HONESTO</strong><br>N√£o escreva o que "deveria" sentir. Escreva o que REALMENTE sente.</li>
                <li><strong>SIGA A SEQU√äNCIA</strong><br>Cada exerc√≠cio prepara o pr√≥ximo. A transforma√ß√£o est√° no processo.</li>
                <li><strong>SALVE SEU PROGRESSO</strong><br>Ao final, voc√™ poder√° baixar um PDF completo com suas respostas.</li>
            </ol>
            
            <div class="info-box">
                <strong>MATERIAIS NECESS√ÅRIOS:</strong>
                <ul class="checklist">
                    <li>Disposi√ß√£o mental</li>
                    <li>Coragem para encarar a verdade</li>
                    <li>Desejo de mudan√ßa</li>
                </ul>
            </div>
            
            <p style="text-align: center; margin-top: 20px; font-style: italic;">
                Em d√∫vida sobre o que est√° sentindo? Consulte o 
                <a href="guia-apoio.html" target="_blank" style="color: #1a472a; font-weight: bold; text-decoration: none;">‚õë Guia de Refer√™ncia Emocional (abre em nova aba)</a>.
            </p>
            <p style="text-align: center; font-weight: bold; margin-top: 30px;">Pronto? Continue...</p>
        </div>

        <div class="step" id="step2">
            <h2>PARTE 1: MAPEANDO SUAS CICATRIZES</h2>
            <h3>EXERC√çCIO 1: AS 3 CICATRIZES PRINCIPAIS</h3>
            
            <p>Toda cicatriz tem elementos fundamentais. N√£o precisamos listar todas as feridas da sua vida agora. Vamos focar nas 3 que mais doem ou que mais moldaram quem voc√™ √© hoje.</p>
            
            <div id="container-cicatrizes"></div>

            <div class="alert-box">
                <strong>‚ö†Ô∏è ATEN√á√ÉO:</strong> Identifique aquelas que geraram cren√ßas como:
                <ul class="checklist" style="margin-top:10px;">
                    <li>"Eu n√£o sou suficiente"</li>
                    <li>"Eu preciso me virar sozinho"</li>
                    <li>"Amor √© condicional"</li>
                    <li>"Sucesso = valor"</li>
                </ul>
            </div>
        </div>

        <div class="step" id="step3">
            <h3>EXERC√çCIO 2: A CICATRIZ RAIZ</h3>
            
            <p>Dessas 3 que voc√™ listou, qual √© a <strong>RAIZ</strong>? Aquela que parece ser a origem das outras.</p>
            <p style="font-size:0.9em; color:#666;">(Geralmente vem da inf√¢ncia/adolesc√™ncia e moldou como voc√™ enxerga o mundo)</p>
            
            <div style="margin-top: 25px;">
                <label>Minha Cicatriz Raiz √©:</label>
                <textarea id="cicatriz_raiz" placeholder="Descreva qual das 3 √© a mais fundamental..."></textarea>
            </div>
            
            <div>
                <label>Ela me ensinou que (Cren√ßa Central):</label>
                <textarea id="raiz_ensino" placeholder="Ex: Que eu n√£o mere√ßo amor se n√£o for √∫til..."></textarea>
            </div>
            
            <div>
                <label>Por causa dela, eu desenvolvi o padr√£o de:</label>
                <div class="checkbox-item"><input type="checkbox" id="p1"><label for="p1">Autossufici√™ncia extrema (N√£o pe√ßo ajuda)</label></div>
                <div class="checkbox-item"><input type="checkbox" id="p2"><label for="p2">Busca por aprova√ß√£o (People Pleaser)</label></div>
                <div class="checkbox-item"><input type="checkbox" id="p3"><label for="p3">Medo de abandono (Ci√∫me/Controle)</label></div>
                <div class="checkbox-item"><input type="checkbox" id="p4"><label for="p4">Perfeccionismo (Medo de errar)</label></div>
                <div class="checkbox-item"><input type="checkbox" id="p5"><label for="p5">Desconfian√ßa (Muros altos)</label></div>
            </div>
            
            <div class="quote-box">
                <strong>REFLEX√ÉO:</strong> Como essa cicatriz raiz aparece na sua vida HOJE? No trabalho, nos relacionamentos ou quando voc√™ est√° sozinho?
            </div>
            
            <div><label>Impacto Atual:</label><textarea id="raiz_impacto" placeholder="Escreva como isso te afeta hoje..."></textarea></div>
        </div>

        <div class="step" id="step4">
            <h3>EXERC√çCIO 3: O CUSTO DAS CICATRIZES</h3>
            <p>Suas cicatrizes n√£o curadas t√™m um pre√ßo alto. Precisamos olhar para esse "extrato" para decidir parar de pagar.</p>
            
            <div><label>Por causa das minhas feridas, eu PERDI:</label><textarea id="custo_perdi"></textarea></div>
            <div><label>Por causa das minhas feridas, eu SABOTEI:</label><textarea id="custo_sabotei"></textarea></div>
            <div><label>Por causa das minhas feridas, eu CONSTRU√ç MUROS em:</label><textarea id="custo_muros"></textarea></div>
            <div><label>A pessoa que mais sofreu com isso foi:</label><input type="text" id="custo_pessoa"></div>
            <div><label>Se eu pudesse voltar no tempo, diria ao meu EU ferido:</label><textarea id="custo_msg"></textarea></div>
            
            <div class="quote-box">"A dor n√£o curada n√£o desaparece. Ela apenas escolhe outras v√≠timas."</div>
        </div>

        <div class="step" id="step5">
            <h3>EXERC√çCIO 4: A RESSIGNIFICA√á√ÉO</h3>
            <p>Agora vamos <strong>TRANSFORMAR</strong> dor em sabedoria. Olhe para as 3 cicatrizes que voc√™ listou.</p>
            
            <div id="container-ressig"></div>
            
            <div class="quote-box">"Suas cicatrizes n√£o s√£o lembran√ßas de derrota. S√£o testemunhos de sobreviv√™ncia."</div>
        </div>

        <div class="step" id="step6">
            <h2>PARTE 2: QUEBRANDO PADR√ïES</h2>
            <h3>EXERC√çCIO 5: SEUS PADR√ïES DE PENSAMENTO</h3>
            <p style="font-size: 0.9em; margin-bottom: 20px; color: #666;">(No livro, chamamos isso de <strong>Autoestradas Mentais</strong>. S√£o caminhos neurais r√°pidos que seu c√©rebro usa no piloto autom√°tico).</p>
            
            <p>Seu c√©rebro criou esses caminhos para te proteger, mas hoje eles podem estar te limitando.</p>
            
            <div id="container-autoestradas"></div>
            
            <div class="info-box">
                <strong>EXEMPLOS COMUNS:</strong>
                <ul class="checklist">
                    <li>"Eu n√£o sou bom o suficiente"</li>
                    <li>"Eu sempre estrago tudo"</li>
                    <li>"Ningu√©m fica comigo"</li>
                    <li>"Eu tenho que provar meu valor"</li>
                </ul>
            </div>
        </div>

        <div class="step" id="step7">
            <h3>EXERC√çCIO 6: A VERDADE LIBERTADORA</h3>
            <p style="font-size: 0.9em; margin-bottom: 20px; color: #666;">(No livro, chamamos isso de <strong>Construir o Desvio</strong>).</p>

            <p>Para cada padr√£o t√≥xico, precisamos criar uma NOVA VERDADE. N√£o √© pensamento positivo, √© uma verdade racional baseada em fatos.</p>
            
            <div id="container-desvios"></div>
            
            <div class="alert-box">‚ö° <strong>LEMBRE-SE:</strong> Voc√™ n√£o destr√≥i um padr√£o de anos com um pensamento m√°gico. Voc√™ constr√≥i um novo caminho (Desvio) praticando a verdade todos os dias.</div>
        </div>

        <div class="step" id="step8">
            <h3>EXERC√çCIO 7: O CONTRATO COMIGO MESMO</h3>
            
            <div><label>Eu, (seu nome completo):</label><input type="text" id="contrato_nome"></div>
            
            <p style="margin-top: 20px;"><strong>Me comprometo:</strong></p>
            <div class="checkbox-item"><input type="checkbox" id="c1"><label for="c1">A parar de trafegar na autoestrada da mentira</label></div>
            <div class="checkbox-item"><input type="checkbox" id="c2"><label for="c2">A construir conscientemente o desvio da verdade</label></div>
            <div class="checkbox-item"><input type="checkbox" id="c3"><label for="c3">A ser paciente comigo no processo</label></div>
            <div class="checkbox-item"><input type="checkbox" id="c4"><label for="c4">A buscar ajuda quando necess√°rio</label></div>
            
            <h3 style="margin-top:40px;">MINHA ROTINA DE RECONSTRU√á√ÉO:</h3>
            <div><label>TODO DIA, eu vou:</label><textarea id="rotina_dia" placeholder="Ex: Ler minhas verdades, orar, meditar..."></textarea></div>
            <div><label>TODA SEMANA, eu vou:</label><textarea id="rotina_semana"></textarea></div>
            
            <div>
                <label>MINHA REDE DE APOIO (Quem pode me ajudar?):</label>
                <input type="text" id="apoio1" placeholder="1. Nome" style="margin-bottom:5px;">
                <input type="text" id="apoio2" placeholder="2. Nome" style="margin-bottom:5px;">
            </div>
            
            <div><label>Data do Contrato:</label><input type="date" id="contrato_data"></div>
            <div class="quote-box">"A mudan√ßa n√£o acontece num dia. Mas come√ßa em um."</div>
        </div>

        <div class="step" id="step9">
            <h2>PARTE 3: CONSTRUINDO SEUS PILARES</h2>
            <h3>EXERC√çCIO 8: O QUE EU BUSCAVA vs. O QUE EU PRECISO</h3>
            <p style="font-size: 0.9em; margin-bottom: 20px; color: #666;">(Conceito do Livro: <strong>P√≥dio Falso vs. P√≥dio Real</strong>)</p>
            
            <p>Muitas vezes, subimos no "p√≥dio" errado (dinheiro, fama, aprova√ß√£o) achando que l√° a dor pararia.</p>

            <div><label>O que eu persegui achando que me completaria (P√≥dio Falso):</label><textarea id="podio_falso" placeholder="Ex: Ser rico, ser famoso, ser perfeito..."></textarea></div>
            <div><label>Por que isso nunca funcionou:</label><textarea id="podio_porq"></textarea></div>
            
            <h3 style="margin-top:40px;">MEUS NOVOS PILARES (O Verdadeiro P√≥dio):</h3>
            
            <div class="card-repeat">
                <div class="cicatriz-header">PILAR 1 - PAZ</div>
                <label>O que significa paz pra mim hoje:</label><textarea id="podio_paz_def"></textarea>
                <label>Como eu construo isso diariamente:</label><textarea id="podio_paz_como"></textarea>
            </div>
            <div class="card-repeat">
                <div class="cicatriz-header">PILAR 2 - RELA√á√ïES</div>
                <label>Quem s√£o as pessoas que realmente importam:</label>
                <textarea id="podio_relacoes_lista" placeholder="Liste os nomes..."></textarea>
                <label>Como eu invisto nelas:</label><textarea id="podio_rel_como"></textarea>
            </div>
            <div class="card-repeat">
                <div class="cicatriz-header">PILAR 3 - PROP√ìSITO</div>
                <label>Para que eu quero usar minha hist√≥ria:</label><textarea id="podio_prop"></textarea>
            </div>
        </div>

        <div class="step" id="step10">
            <h3>EXERC√çCIO 9: ASSUMINDO MEU VALOR</h3>
            <p>Muitas vezes esperamos que os outros nos valorizem. Mas a verdade √© que o mundo s√≥ enxerga o valor que n√≥s mesmos reconhecemos.</p>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">Chegou a hora de tomar posse da sua hist√≥ria.</p>
            
            <h3 style="margin-top:30px;">O QUE EU ESCOLHO INTERNALIZAR HOJE:</h3>
            
            <div class="card-repeat">
                <div class="cicatriz-header">1. SOBRE QUEM EU SOU</div>
                <label>Eu N√ÉO sou definido por:</label><input type="text" id="venda_valor_nao" placeholder="Ex: meus erros do passado ou opini√µes alheias">
                <label>A verdade √© que eu SOU:</label><input type="text" id="venda_valor_sim" placeholder="Ex: algu√©m resiliente, capaz de aprender e amar">
            </div>
            
            <div class="card-repeat">
                <div class="cicatriz-header">2. SOBRE MINHAS CICATRIZES</div>
                <label>Elas n√£o s√£o um sinal de fraqueza.</label>
                <label>Elas s√£o a prova concreta de que:</label><input type="text" id="venda_pass_sim" placeholder="Ex: eu sou mais forte do que imaginava">
            </div>
            
            <div style="margin-top:30px;">
                <label>POR QUE EU MERE√áO UMA NOVA VIDA (Minhas Evid√™ncias de For√ßa):</label>
                <textarea id="venda_argumento" placeholder="Ex: Porque eu n√£o desisti mesmo quando tudo desabou. Porque eu continuo buscando ser melhor..."></textarea>
            </div>
            
            <div><label>MEU DECRETO PESSOAL (Compromisso):</label><textarea id="venda_compromisso" placeholder="Eu me comprometo a me tratar com o mesmo respeito que trato os outros..."></textarea></div>
        </div>

        <div class="step" id="step11">
            <h3>EXERC√çCIO 10: MINHA DECLARA√á√ÉO DE RECONSTRU√á√ÉO</h3>
            <p>Esta √© a sua nova biografia. Complete com for√ßa.</p>
            
            <div><label>EU SOU algu√©m que:</label><textarea id="decl_sou"></textarea></div>
            <div><label>EU N√ÉO SOU MAIS definido por:</label><textarea id="decl_nao"></textarea></div>
            <div><label>MINHAS CICATRIZES me ensinaram:</label><textarea id="decl_cicatrizes"></textarea></div>
            <div><label>MEU MAIOR MEDO hoje √©:</label><textarea id="decl_medo"></textarea></div>
            <div><label>Mas EU SEI que:</label><textarea id="decl_sei"></textarea></div>
            <div><label>EM 1 ANO, eu quero olhar no espelho e ver:</label><textarea id="decl_1ano"></textarea></div>
            
            <div style="margin-top:20px;">
                <label>A PESSOA QUE EU QUERO SER √© algu√©m que:</label>
                <div class="checkbox-item"><input type="checkbox" id="ser1"><label for="ser1">Vive com paz interior</label></div>
                <div class="checkbox-item"><input type="checkbox" id="ser2"><label for="ser2">Ama profundamente</label></div>
                <div class="checkbox-item"><input type="checkbox" id="ser3"><label for="ser3">Serve com prop√≥sito</label></div>
                <div class="checkbox-item"><input type="checkbox" id="ser4"><label for="ser4">Enfrenta a verdade</label></div>
                <div class="checkbox-item"><input type="checkbox" id="ser5"><label for="ser5">Honra suas cicatrizes</label></div>
            </div>
            
            <div class="quote-box">"Voc√™ n√£o √© o que aconteceu com voc√™. Voc√™ √© o que voc√™ escolhe se tornar."</div>
        </div>

        <div class="step" id="step12">
            <h2>PARAB√âNS! üéâ</h2>
            <p style="font-size: 1.2em;">Voc√™ completou o mapeamento das suas cicatrizes.</p>
            <p>Mas este n√£o √© o fim. √â o <strong>COME√áO</strong> da sua reconstru√ß√£o.</p>
            
            <h3 style="margin-top:30px;">O QUE FAZER AGORA:</h3>
            <ol class="instruction-list">
                <li><strong>BAIXE SEU PDF</strong><br>Salve suas respostas e releia sempre que se sentir perdido.</li>
                <li><strong>PRATIQUE SEU "DESVIO"</strong><br>Escolha um Padr√£o de Pensamento para combater essa semana.</li>
                <li><strong>N√ÉO PARE AQUI</strong><br>A cura √© um processo di√°rio.</li>
            </ol>
            
            <div class="alert-box">
                <strong>NOTA:</strong> O PDF gerado abaixo foi formatado para ser limpo e direto, ideal para impress√£o ou leitura digital.
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-pdf" style="font-size:1.2em; padding:15px 40px;" onclick="generatePDF()">
                    <i class="fas fa-file-pdf"></i> BAIXAR WORKBOOK COMPLETO (PDF)
                </button>
            </div>
            
            <hr style="border:0; border-top:1px solid #ccc; margin:40px 0;">
            
            <h2>RECURSOS ADICIONAIS</h2>
            <div style="text-align: left; background: #fafafa; padding: 20px; border-radius: 8px;">
                <p><strong>üìñ LEIA O LIVRO COMPLETO:</strong> "O Mapa das Cicatrizes" - Cl√©verson E. Costa</p>
                <p><strong>üí¨ PARTICIPE DA COMUNIDADE:</strong> Instagram: @cleverson.costaoficial</p>
            </div>
            
            <div class="quote-box">"Suas cicatrizes s√£o o mapa mais honesto que voc√™ tem para chegar ao seu destino."</div>
        </div>

        <div class="nav-controls" id="navControls" style="display:none;">
            <button class="btn btn-prev" onclick="prevStep()">Voltar</button>
            <div style="font-size: 0.8em; color: #999;" id="stepCounter"></div>
            <button class="btn btn-next" onclick="nextStep()">Continuar</button>
        </div>

    </div>

    <div id="print-area">
        <div class="pdf-header">
            <h1 style="color: #1a472a; font-size: 24px; margin-bottom:5px;">O MAPA DAS CICATRIZES</h1>
            <p>Relat√≥rio de Reconstru√ß√£o Pessoal</p>
            <p style="font-size: 12px; margin-top: 5px;">Autor: Cl√©verson E. Costa</p>
        </div>
        <div id="pdf-content"></div>
        <div style="text-align: center; margin-top: 50px; border-top: 1px solid #eee; padding-top: 20px; font-size: 10px; color: #666;">
            "Um testemunho sobre o poder da gra√ßa e o mapa invis√≠vel tra√ßado nas cicatrizes da alma."
        </div>
    </div>

    <script>
        let currentStep = 0;
        const totalSteps = 12; // 0 a 12 (13 telas)
        
        const motivationalPhrases = [
            "A jornada come√ßa agora.", // Capa
            "Preparando o terreno...", // Intro
            "Coragem para olhar.", // Cicatrizes
            "Encontrando a raiz.", // Raiz
            "Reconhecendo o custo.", // Custo
            "Transformando dor em ouro.", // Ressignifica√ß√£o
            "Identificando padr√µes.", // Padr√µes (Autoestradas)
            "Construindo novos caminhos.", // Verdades (Desvios)
            "Firmando o compromisso.", // Contrato
            "Erguendo seus pilares.", // Pilares (P√≥dio)
            "Acredite em voc√™.", // Valor (Vendas)
            "Quem voc√™ se torna.", // Declara√ß√£o
            "Miss√£o cumprida!" // Parab√©ns
        ];

         window.onload = function() {
            renderDynamicFields();
            loadLocalStorage(); 
            
            const urlParams = new URLSearchParams(window.location.search);
            const nomeUrl = urlParams.get('user_name');
            
            if(nomeUrl) {
                const campoNome = document.getElementById('contrato_nome');
                if(campoNome && !campoNome.value) { 
                    campoNome.value = nomeUrl;
                    saveLocalStorage(); 
                }
            }

            updateUI();
        };

        function renderDynamicFields() {
            // CICATRIZES (AGORA S√ÉO 3)
            const cContainer = document.getElementById('container-cicatrizes');
            for(let i=1; i<=3; i++) {
                cContainer.innerHTML += `
                    <div class="card-repeat">
                        <div class="cicatriz-header">CICATRIZ ${i}</div>
                        <label>Evento (o que aconteceu):</label>
                        <input type="text" id="c${i}_evento" placeholder="${i === 1 ? 'Ex: Meu pai me abandonou...' : ''}">
                        
                        <label>O que eu senti:</label>
                        <textarea id="c${i}_sentimento" placeholder="Ex: Medo, abandono..."></textarea>
                        
                        <label>A cren√ßa que isso gerou (Mentira):</label>
                        <textarea id="c${i}_crenca" placeholder="Ex: Que eu n√£o sou suficiente..."></textarea>
                    </div>
                `;
            }

            // RESSIGNIFICA√á√ÉO (3)
            const rContainer = document.getElementById('container-ressig');
            for(let i=1; i<=3; i++) {
                rContainer.innerHTML += `
                    <div class="card-repeat">
                        <div class="cicatriz-header">CICATRIZ ${i}</div>
                        <label>O que a dor me ensinou:</label><textarea id="r${i}_ensino"></textarea>
                        <label>O que ainda carrego daqui (for√ßa/sabedoria):</label><textarea id="r${i}_forca"></textarea>
                    </div>
                `;
            }

            // PADR√ïES (ANTIGAS AUTOESTRADAS) - 3
            const aContainer = document.getElementById('container-autoestradas');
            for(let i=1; i<=3; i++) {
                aContainer.innerHTML += `
                    <div class="card-repeat">
                        <div class="cicatriz-header">PADR√ÉO ${i}</div>
                        <label>Pensamento autom√°tico (Mentira):</label><input type="text" id="a${i}_pensamento" placeholder="${i === 1 ? 'Ex: Eu sempre estrago tudo' : ''}">
                        <label>Origem (qual cicatriz gerou isso?):</label><input type="text" id="a${i}_origem">
                        <label>Frequ√™ncia:</label>
                        <div class="checkbox-item"><input type="radio" name="freq${i}" id="a${i}_diaria" value="Di√°ria"><label for="a${i}_diaria">Di√°ria</label></div>
                        <div class="checkbox-item"><input type="radio" name="freq${i}" id="a${i}_semanal" value="Semanal"><label for="a${i}_semanal">Semanal</label></div>
                        <div class="checkbox-item"><input type="radio" name="freq${i}" id="a${i}_crise" value="Crise"><label for="a${i}_crise">Em crises</label></div>
                    </div>
                `;
            }

            // VERDADES (ANTIGOS DESVIOS) - 3
            const dContainer = document.getElementById('container-desvios');
            for(let i=1; i<=3; i++) {
                dContainer.innerHTML += `
                    <div class="card-repeat">
                        <div class="cicatriz-header">VERDADE ${i}</div>
                        <label>EM VEZ DE PENSAR (Padr√£o Antigo):</label><input type="text" id="d${i}_autoestrada" placeholder="Cole o pensamento do exerc√≠cio anterior">
                        <label>EU VOU PENSAR (Nova Verdade):</label><textarea id="d${i}_verdade" placeholder="A verdade √© que..."></textarea>
                        <label>DECLARA√á√ÉO DI√ÅRIA:</label><textarea id="d${i}_declaracao"></textarea>
                    </div>
                `;
            }
        }

        // --- SISTEMA DE NAVEGA√á√ÉO ---
        function updateUI() {
            document.querySelectorAll('.step').forEach((el, index) => {
                el.classList.remove('active');
                if(index === currentStep) el.classList.add('active');
            });

            const percent = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('progressText').innerText = motivationalPhrases[currentStep] || "Continuando...";

            const nav = document.getElementById('navControls');
            if(currentStep === 0) nav.style.display = 'none';
            else {
                nav.style.display = 'flex';
                document.getElementById('stepCounter').innerText = `${currentStep}/${totalSteps}`;
                const btnNext = document.querySelector('.btn-next');
                if(currentStep === totalSteps) btnNext.style.display = 'none';
                else btnNext.style.display = 'block';
            }
            saveLocalStorage();
            window.scrollTo(0,0);
        }

        function nextStep() { if(currentStep < totalSteps) { currentStep++; updateUI(); } }
        function prevStep() { if(currentStep > 0) { currentStep--; updateUI(); } }

        // --- SISTEMA DE DADOS ---
        function collectData() {
            const allInputs = document.querySelectorAll('input, textarea');
            const data = {};
            allInputs.forEach(input => {
                if(input.id) {
                    if(input.type === 'checkbox' || input.type === 'radio') {
                        if(input.checked) data[input.id] = true; 
                    } else {
                        data[input.id] = input.value;
                    }
                }
            });
            return data;
        }

        function saveLocalStorage() { localStorage.setItem('workbook_data_v2', JSON.stringify(collectData())); }
        
        function loadLocalStorage() {
            const data = JSON.parse(localStorage.getItem('workbook_data_v2'));
            if(data) populateFields(data);
        }

        function populateFields(data) {
            for(const key in data) {
                const el = document.getElementById(key);
                if(el) {
                    if(el.type === 'checkbox' || el.type === 'radio') el.checked = true;
                    else el.value = data[key];
                }
            }
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(collectData()));
            const node = document.createElement('a');
            node.setAttribute("href", dataStr);
            node.setAttribute("download", "meu_mapa_backup.json");
            document.body.appendChild(node);
            node.click();
            node.remove();
        }

        function importData(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    populateFields(JSON.parse(e.target.result));
                    saveLocalStorage();
                    alert("Backup restaurado com sucesso!");
                } catch(err) { alert("Erro ao ler arquivo."); }
            };
            reader.readAsText(file);
        }

        // --- GERADOR DE PDF CORRIGIDO (VERS√ÉO FINAL) ---
        function generatePDF() {
            // 1. Rolar para o topo para evitar o bug do espa√ßo em branco
            window.scrollTo(0, 0);

            const contentDiv = document.getElementById('pdf-content');
            contentDiv.innerHTML = '';
            
            // DADOS INICIAIS
            const contratoNome = document.getElementById('contrato_nome').value || "Viajante";
            const dataHoje = new Date().toLocaleDateString('pt-BR');
            let html = `<div style="text-align:center; margin-bottom:20px;"><strong>Propriet√°rio:</strong> ${contratoNome} | <strong>Data:</strong> ${dataHoje}</div>`;

            // DEFINI√á√ÉO DAS SE√á√ïES
            const sections = [
                { title: "Parte 1: As 3 Cicatrizes", ids: [] },
                { title: "Cicatriz Raiz", ids: ["cicatriz_raiz", "raiz_ensino", "p1", "p2", "p3", "p4", "p5", "raiz_impacto"] },
                { title: "O Custo", ids: ["custo_perdi", "custo_sabotei", "custo_muros", "custo_pessoa", "custo_msg"] },
                { title: "Ressignifica√ß√£o", ids: [] },
                { title: "Parte 2: Padr√µes de Pensamento", ids: [] },
                { title: "A Verdade Libertadora", ids: [] },
                { title: "Parte 3: Contrato", ids: ["contrato_nome", "c1", "c2", "c3", "c4", "rotina_dia", "rotina_semana", "apoio1", "apoio2"] },
                { title: "Meus Pilares (P√≥dio)", ids: ["podio_falso", "podio_porq", "podio_paz_def", "podio_paz_como", "podio_relacoes_lista", "podio_rel_como", "podio_prop"] },
                { title: "Assumindo Meu Valor", ids: ["venda_valor_nao", "venda_valor_sim", "venda_pass_sim", "venda_argumento", "venda_compromisso"] },
                { title: "Declara√ß√£o Final", ids: ["decl_sou", "decl_nao", "decl_cicatrizes", "decl_medo", "decl_sei", "decl_1ano", "ser1", "ser2", "ser3", "ser4", "ser5"] }
            ];

            // Preencher IDs din√¢micos
            for(let i=1; i<=3; i++) sections[0].ids.push(`c${i}_evento`, `c${i}_sentimento`, `c${i}_crenca`);
            for(let i=1; i<=3; i++) sections[3].ids.push(`r${i}_ensino`, `r${i}_forca`);
            for(let i=1; i<=3; i++) {
                sections[4].ids.push(`a${i}_pensamento`, `a${i}_origem`);
                sections[5].ids.push(`d${i}_autoestrada`, `d${i}_verdade`, `d${i}_declaracao`);
            }

            // GERA√á√ÉO DO HTML INTELIGENTE
            sections.forEach(sec => {
                let sectionContent = "";
                let hasData = false;
                
                sec.ids.forEach(id => {
                    const el = document.getElementById(id);
                    if(!el) return;

                    // L√≥gica para Inputs de Texto
                    if(el.type === 'text' || el.tagName === 'TEXTAREA' || el.type === 'date') {
                        if(el.value) {
                            hasData = true;
                            let labelTxt = id; 
                            const prev = el.previousElementSibling;
                            if(prev && (prev.tagName === 'LABEL' || prev.tagName === 'STRONG' || prev.className === 'cicatriz-header')) {
                                 labelTxt = prev.innerText;
                            }
                            
                            // Separadores visuais
                            if(id.includes('_evento')) sectionContent += `<div style="margin-top:10px; border-top:1px dashed #ddd; padding-top:5px; color:var(--accent); font-weight:bold; font-size:0.8em;">EXPERI√äNCIA</div>`;
                            if(id.includes('_pensamento')) sectionContent += `<div style="margin-top:10px; border-top:1px dashed #ddd;"></div>`;

                            sectionContent += `<div class="pdf-q">${labelTxt}</div><div class="pdf-a">${el.value}</div>`;
                        }
                    }
                    // L√≥gica para Checkboxes
                    else if(el.type === 'checkbox' || el.type === 'radio') {
                        if(el.checked) {
                            hasData = true;
                            const labelEl = el.nextElementSibling;
                            if(labelEl && labelEl.tagName === 'LABEL') {
                                sectionContent += `<div class="pdf-check-item"><span class="pdf-check-icon">‚òë</span> <span>${labelEl.innerText}</span></div>`;
                            }
                        }
                    }
                });

                if(hasData) {
                    // Aqui envolvemos cada se√ß√£o em uma DIV com a classe pdf-section para evitar a quebra
                    html += `<div class="pdf-section"><div class="pdf-section-title">${sec.title}</div>${sectionContent}</div>`;
                }
            });

            contentDiv.innerHTML = html;
            const element = document.getElementById('print-area');
            element.style.display = 'block';

            // CONFIGURA√á√ÉO AVAN√áADA PARA CORRIGIR BUGS VISUAIS
            const opt = {
                margin: [0.5, 0.5, 0.5, 0.5], // Margens: Topo, Esquerda, Baixo, Direita (Polegadas)
                filename: 'Meu_Mapa_Das_Cicatrizes.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    scrollY: 0, // CRUCIAL: Ignora a rolagem da tela e for√ßa o topo
                    useCORS: true
                },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] } // CRUCIAL: Evita cortar elementos ao meio
            };

            html2pdf().set(opt).from(element).save().then(() => {
                element.style.display = 'none';
            });
        }
    </script>
</body>
</html>
